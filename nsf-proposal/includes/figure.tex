\begin{<< env >>}
  \setlength{\dimen0}{\textwidth-<<width>>}
  \setlength{\dimen1}{1em}
  \addtolength{\dimen0}{-\dimen1}

  \ifthenelse{\lengthtest{\dimen0 < 1.5in}}
    {
      \setlength{\dimen0}{\textwidth}
      \setlength{\dimen1}{0em}
    } {}

  \begin{minipage}[t]{<< width >>}
    \includegraphics[<< size >>]{<< file >>}
  \end{minipage}\hspace{\dimen1}\begin{minipage}[b]{\dimen0}
    <# if caption -#>
    \captionof{figure}[<<title>>]{<< caption >>}
    <#- else -#>
    \captionlistentry[figure]{<< title >>}
    <#- endif #>\label{fig:<< id >>}
  \end{minipage}
\end{<< env >>}

