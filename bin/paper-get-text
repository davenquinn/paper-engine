#!/usr/bin/env zsh

while [[ "$#" -gt 0 ]]; do case $1 in
  -a|--abstract) abstract=1;;
  -A|--appendices) appendices=1;;
  -c|--captions) captions=1;;
  --absolute) absolute=1;;
  --dry-run) dry_run=1;;
  *) echo "Unknown parameter passed: $1"; exit 1;;
esac; shift; done

# need to make this override-able...
cd $PAPER_DIR
source paper-defs.zsh

## Assemble a list of files
files=()
[ $abstract ] && files+=(text/abstract.md)

# Use variables by default if set
files+=${main_text:-(text/chapters/*.md)}


[ $appendices ] && files+=(text/appendices/*.md(N))
[ $captions ] && files+=(text/figure-captions.md)

prefix=""
[ $absolute ] && prefix="$(pwd)/"

for fn in ${files[@]}; do
if [ $dry_run ]; then
    echo "$prefix$fn"
else
    cat $fn
    echo "\n\n"
fi
done
