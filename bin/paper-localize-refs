#!/usr/bin/env zsh

source "$PAPER_DIR/paper-defs.zsh"

build="$PAPER_DIR/build"
auxfile="$build/$name.aux"
bibfile="${bibfile:-"$PAPER_DIR/text/references.bib"}"

echo "Filtering bibliography"
refs="$build/references.txt"
paper get-text --captions \
| paper extract-refs \
> $refs

if [ -z $BIBTEX_LIBRARY ]; then
  echo "Environment variable BIBTEX_LIBRARY not found, so filtering cannot proceed."
  exit 0
fi

bib-filter --clean \
  --keys $refs $BIBTEX_LIBRARY $bibfile

